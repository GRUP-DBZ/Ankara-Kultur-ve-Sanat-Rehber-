{% extends 'layout.html' %}
{% block content %}

  {% set featured = events[0] if events|length > 0 else None %}

  <!-- Hero -->
  <section class="hero-dark">
    <div class="container-xl">
      <div class="row align-items-center g-4">
        <div class="col-lg-6">
          {% if featured %}
            <div class="eyebrow text-uppercase">{{ featured.categories | map(attribute='name') | join(', ') }}</div>
            <h1 class="display-4 fw-bold hero-title">{{ featured.title }}</h1>
            <p class="hero-lead">{{ featured.description or 'Etkinlik detayları hemen aşağıda.' }}</p>
            <div class="d-flex flex-wrap gap-2 mt-3">
              <span class="chip">{{ featured.start_time.strftime('%d.%m.%Y %H:%M') }}{% if featured.end_time %} — {{ featured.end_time.strftime('%d.%m.%Y %H:%M') }}{% endif %}</span>
              {% if featured.location %}<span class="chip light">{{ featured.location }}</span>{% endif %}
            </div>
            <div class="d-flex flex-wrap gap-3 mt-4">
              <a href="/event/{{ featured.id }}" class="btn pill-btn">Detay</a>
              <a href="{{ url_for('main.book_ticket') }}" class="btn pill-btn ghost">Bilet Al</a>
            </div>
          {% else %}
            <div class="eyebrow text-uppercase">Etkinlik</div>
            <h1 class="display-4 fw-bold hero-title">Etkinlik bulunamadı</h1>
            <p class="hero-lead">Yeni etkinlikler eklendiğinde burada göreceksiniz.</p>
          {% endif %}
        </div>
        <div class="col-lg-6 d-none d-lg-block">
          <div class="hero-visual">
            <div class="orbit"></div>
            {% if featured %}
              <div class="hero-image" style="background-image:url('{{ featured.image_url or url_for('static', filename='img/placeholders/event-placeholder.png') }}')"></div>
            {% else %}
              <div class="hero-image" style="background-image:url('{{ url_for('static', filename='img/placeholders/event-placeholder.png') }}')"></div>
            {% endif %}
          </div>
        </div>
      </div>
    </div>
  </section>

  <div class="container-xl section-gap">
    <div class="d-flex flex-wrap justify-content-between align-items-center mb-4">
      <div>
        <h2 class="section-title">Etkinliklerden Kareler</h2>
        <p class="text-muted mb-0">Sanatseverleri bir araya getiren konser, tiyatro, sergi ve atölyeler.</p>
      </div>
      <form method="get" class="d-flex gap-2 filter-bar">
        <select name="category" class="form-select" onchange="this.form.submit()">
          <option value="">Tüm Kategoriler</option>
          {% for c in categories %}
            <option value="{{ c.name }}" {% if selected_category==c.name %}selected{% endif %}>{{ c.name }}</option>
          {% endfor %}
        </select>
        <a class="btn pill-btn ghost" href="/">Temizle</a>
      </form>
    </div>

    <div class="row g-4">
      {% for e in events %}
        <div class="col-12 animate-on-scroll" data-ani>
          <article class="event-tile">
            <div class="event-main">
              <div class="event-meta">
                <span class="dot"></span>
                <span>{{ e.start_time.strftime('%d.%m.%Y %H:%M') }}</span>
                {% if e.location %}<span class="dot"></span><span>{{ e.location }}</span>{% endif %}
              </div>
              <h3 class="event-title">{{ e.title }}</h3>
              <p class="event-desc">{{ (e.description[:200] + '...') if e.description and e.description|length > 200 else (e.description or '') }}</p>
              <div class="event-tags">
                <span class="tag">{{ e.categories | map(attribute='name') | join(', ') }}</span>
                <a class="btn pill-btn tiny" href="/event/{{ e.id }}">Detaylı Bilgi</a>
                <a class="btn pill-btn ghost tiny" href="{{ url_for('main.book_ticket') }}?event_id={{ e.id }}">Bilet Al</a>
              </div>
            </div>
            <div class="event-thumb">
                <img src="{{ e.image_url or url_for('static', filename='img/placeholders/event-placeholder.png') }}" alt="{{ e.title }}">
            </div>
          </article>
        </div>
      {% else %}
        <div class="col-12">
          <div class="alert alert-info">Gösterilecek etkinlik yok.</div>
        </div>
      {% endfor %}
    </div>

    <div class="mt-5 text-center">
      <a class="btn pill-btn" href="#">Tüm Etkinlikleri Göster</a>
    </div>
  </div>
{% endblock %}
